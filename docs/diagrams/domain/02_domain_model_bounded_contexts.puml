@startuml BoundedContexts
!pragma layout smetana

title Bounded Contexts\nTravel SaaS Platform
caption Last updated: 2025-11-10

' ----------------------------------------------------------
' Existing bounded contexts
' ----------------------------------------------------------

/'package "Identity & Access\nContext" as IdentityContext #LightBlue {
  rectangle "User" #White
  rectangle "Authentication" #White
  rectangle "Authorization" #White

  note bottom
    **Core Responsibilities:**
    • User registration & profile
    • Authentication & tokens
    • Role & permission management
    • Tenant configuration
  end note
}'/

package "Itinerary Management\nContext" as ItineraryContext #LightGreen {
  rectangle "Itinerary" #White
  rectangle "Location" #White
  rectangle "Trip Planning" #White

  note bottom
    **Core Responsibilities:**
    • Create & manage itineraries
    • Manage locations & visits
    • Trip scheduling & planning
    • Visibility settings
  end note
}

package "Social Interaction\nContext" as SocialContext #LightCoral {
  rectangle "Like" #White
  rectangle "Comment" #White
  rectangle "Engagement" #White

  note bottom
    **Core Responsibilities:**
    • Like/unlike itineraries
    • Comment on itineraries
    • Track user engagement
  end note
}

package "Personalized Feed\nContext" as FeedContext #LightYellow {
  rectangle "Feed Generation" #White
  rectangle "Recommendation\nEngine" #White
  rectangle "Ranking" #White

  note bottom
    **Core Responsibilities:**
    • Generate personalized feed
    • Analyze user preferences
    • Rank & score content
    • Handle recommendation signals
  end note
}

' ----------------------------------------------------------
' NEW Bounded Context: Travel Warnings
' ----------------------------------------------------------

package "Travel Warnings\nContext" as WarningContext #LightSkyBlue {
  rectangle "WarningFetcher\n(Service)" #White
  rectangle "WarningNormalizer\n(Service)" #White
  rectangle "RiskMatching\n(Service)" #White
  rectangle "WarningNotification\n(Service)" #White

  note bottom
    **Core Responsibilities:**
    • Fetch official travel warnings (AA OpenData)
    • Normalize & categorize HTML content
    • Detect updates & match against trips
    • Notify travellers proactively
  end note
}

' ----------------------------------------------------------
' Relationships
' ----------------------------------------------------------

' Identity is shared kernel for user identity
/'IdentityContext -down-> ItineraryContext : <<Shared Kernel>>\nUser ID
IdentityContext -down-> SocialContext : <<Shared Kernel>>\nUser ID
IdentityContext -down-> FeedContext : <<Shared Kernel>>\nUser ID'/

' Travel warnings need user ID for notifications
' IdentityContext -right-> WarningContext : <<Shared Kernel>>\nUser ID

' Itinerary is consumer of warnings (destination matching)
ItineraryContext -right-> WarningContext : <<Customer/Supplier>>\nTrip Country Codes

' Warning Context publishes events (updates, matches)
WarningContext ..> FeedContext : <<Published Events>>\nRiskNotificationIssued

' Warning Context subscribes to itinerary events
ItineraryContext ..> WarningContext : <<Published Events>>\nItineraryCreated/Updated

note right of FeedContext
  **Event Subscriptions:**
  • ItineraryCreated
  • ItineraryUpdated
  • ItineraryLiked
  • CommentAdded
  • LocationVisited
  • RiskNotificationIssued
end note

note right of WarningContext
  **Event Subscriptions:**
  • ItineraryCreated
  • ItineraryUpdated

  **Events Published:**
  • WarningUpdated
  • RiskNotificationIssued
end note

' ----------------------------------------------------------
' Legend
' ----------------------------------------------------------

legend right
  |= Pattern |= Description |
  | <<Shared Kernel>> | Shared concept (User ID) |
  | <<Customer/Supplier>> | Direct reference by ID |
  | <<Published Events>> | Async event-driven |

  |= Color |= Context |
  | <#LightBlue> | Identity & Access |
  | <#LightGreen> | Itinerary Management |
  | <#LightCoral> | Social Interaction |
  | <#LightYellow> | Personalized Feed |
  | <#LightSkyBlue> | Travel Warnings |
endlegend

/'note as ContextNote
  **Context Integration Strategy:**

  • Each bounded context is an independent microservice
  • Contexts communicate via events (Pub/Sub)
  • No shared databases between contexts
  • User ID is the only shared kernel concept
  • Itinerary ID & Location ID referenced by value
  • Travel Warnings context reacts to itinerary events
  • Feed context receives notification events for ranking
  • Eventual consistency for risk alerts
end note'/

@enduml
